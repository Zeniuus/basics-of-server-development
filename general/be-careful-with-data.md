# 데이터의 중요성과 위험성

이 문서에서는 데이터의 중요성과 다루기 어려움에 대해 이야기한다.

## 데이터의 중요성

서버 개발자의 핵심 업무 중 하나는 바로 데이터를 올바른 형태로 다루는 것이다.

데이터는 비즈니스 가치 달성의 핵심이다. 서비스는 데이터를 일정한 방식으로 저장하고, 변경하고, 조회하는 것으로 유저에게 서비스를 제공한다. 은행 서비스를 생각해보자. 송금이라는 행위는 어떻게 이루어지는가? 이는 송금 트랜잭션 이벤트를 저장하고, 한 유저의 잔고 데이터를 감소시키고, 다른 유저의 잔고 데이터를 증가시킴으로써 달성할 수 있다. 즉, 송금이라는 서비스를 제공하는 것은 오로지 데이터를 원하는 대로 조작함으로써 이루어지는 것이다. 다른 많은 서비스도 마찬가지이다. 데이터 없이 순수히 computation으로 제공할 수 있는 비즈니스 가치는 별로 없다.

여기에 더해, 데이터는 사업과 프로덕트의 방향성을 결정할 때 매우 중요한 요소이다. BI 리포트, A/B 테스팅 결과, 프로덕트의 퍼널별 이탈율 등 수많은 핵심 지표는 바로 적재된 데이터를 분석함으로로써 도출하는 것이다. 이러한 데이터 기반의 지표는 사업 전략, 사업 기획, 프로덕트 기획 등 회사 전반에서 일어나는 결정에 큰 결정을 미친다.

API가 실행되고 나면 남는 것은 DB에 저장된 데이터 뿐이다. 서버는 다운돼도 다시 띄우면 되지만, 데이터는 날라가면 그대로 서비스 종료다. 데이터는 IT 비즈니스의 핵심이다.

그리고, 이렇게 중요한 데이터를 관리하는 것은 바로 서버팀의 책임이다. 서버 개발자는 비즈니스 규칙을 올바르게 구현하여 데이터를 회사가 원하는 대로 다루고, 적절한 데이터 저장 기술을 사용하여 적재된 데이터를 관리한다.

## 데이터 리팩토링은 어렵다

애자일 방법론에서는 지속적 리팩토링의 중요성을 강조한다. 모든 비즈니스 요구사항을 완벽하게 수집하는 것보다 현재 알고 있는 비즈니스 요구사항을 만족시킨 뒤 빠르게 이터레이션을 돌리는 게 중요한데, 여기에 있어 새로운 요구사항을 수용할 수 있도록 지속적으로 코드 베이스를 리팩토링하는 건 필수불가결이다.

여기서의 리팩토링은 코드 뿐만 아니라 데이터의 리팩토링도 포함된다. 비즈니스가 점차 복잡해질수록 요구사항이 추가되고, 기존에 존재하던 모델이 비대해진다. 이것이 일정 수준을 넘기면 우리는 데이터 모델을 리팩토링하고 싶다는 생각을 하게 된다. 그 때 당시에는 최선이었던 데이터 모델이, 비즈니스가 고도로 복잡해진 현재는 최선이 아닐 수 있다.

하지만, 데이터는 몇 가지 이유로 인해 변경하기가 까다롭다.

### 데이터는 누적된다

데이터를 변경하기 어려운 첫 번째 이유는 바로 **휘발되지 않고 누적된다는 데이터의 성질**이다. 서버 코드는 기본적으로 가장 최신 버전만 프로덕션 환경에 영향을 준다. git과 같은 버전 관리 시스템에 과거의 코드가 저장되어 있긴 하지만, 프로덕션 환경에 배포되는 코드는 가장 마지막 버전의 코드 한 벌이다. 데이터는 다르다. 데이터는 서비스 런칭 직후부터 꾸준히 쌓이고, 일부러 지우지 않는 한 사라지지 않는다.

이렇게 쌓인 데이터는 우리의 자산이기도 하지만, 우리를 기민하게 움직이기 어렵게 만드는 장애물이 되기도 한다.

- RDB - RDB의 스키마는 코드처럼 그냥 변경할 수 없다. 이미 저장되어 있는 데이터가 존재하기 때문이다. RDB 스키마를 리팩토링하려면 그 데이터들을 전부 마이그레이션 하고, 그 과정에서 스키마에 과도기를 두는 등 번거로운 과정이 필요하다.
- NoSQL - 스키마를 배포할 필요가 없는 NoSQL을 사용하더라도 마찬가지다. NoSQL은 write 할 때 스키마가 없는 거지, read 할 때는 RDB와 마찬가지로 스키마가 존재한다. Read 스키마를 변경하면 어플리케이션 딴에서 기존 버전의 스키마로 저장되어 있는 데이터와 새 버전의 스키마로 저장되어 있는 데이터를 둘 다 고려해서 코드를 작성해야 한다. 스키마 변경을 여러번 했다면? 해당 버전들을 모두 고려한 서버 코드를 작성해야 한다.

### 데이터는 의존하는 컴포넌트가 많다

데이터를 변경하기 어려운 두 번째 이유는 **데이터에 의존하고 있는 컴포넌트가 많다는 것**이다. [데이터의 중요성](/general/be-careful-with-data.md#데이터의-중요성) 단락에서 이야기했듯이, 데이터는 비즈니스에 매우 중요한 요소여서 여기저기 사용된다. 이 말은 데이터를 변경할 경우 영향을 받는 컴포넌트가 매우 많다는 뜻이다. 의존을 많이 받는 코드가 변경하기 어렵듯, 의존을 많이 받는 데이터 역시 변경하기 어렵다.

테이블의 이름을 변경하거나, 일부 필드를 다른 테이블로 옮기는 경우를 생각해보자. 어떤 컴포넌트가 영향을 받을까? 우선 당연히 해당 테이블을 직접 조회/수정하는 서버 코드가 영향을 받을 것이다. 하지만 여기서 끝이 아니다. 이 변경은 해당 DB에 접속해서 데이터를 긁어가는 데이터 파이프라인과 데이터 웨어하우스에도 영향을 미친다. 데이터 웨어하우스에 영향을 미친다는 것은, 해당 데이터 웨어하우스에 날리는 모든 SQL 문이 영향을 받는다는 뜻이다. 회사에 존재하는 모든 SQL 기반의 리포트도 변경에 영향을 받는 대상이다. DB 테이블을 변경할 때는 이 모든 것을 고려해야 한다. 당연히 DB 테이블 리팩토링의 비용은 어마어마하다.

## 데이터 조작(mutation)은 두렵다

앞서 말했듯, 서버 개발자의 주된 업무는 비즈니스 규칙에 맞춰 데이터를 조작하는 것이다. 일정한 규칙에 따라 데이터를 변경해야 데이터의 정합성이 유지될 수 있다.

하나의 비즈니스 로직을 올바르게 작성하는 것은 그리 어렵지 않다. 하지만, 가끔 올바르게 작성한 비즈니스 로직도 다른 곳에 예상치 못한 영향을 끼치기도 한다. 예를 들어, 도서관에서 책을 빌리는 서비스를 생각해보자. 유저가 책을 빌리려면 우선 `대여 요청`을 날려야 한다. 그리고 사서가 `대여 요청`을 승인하면 `대여` 객체가 만들어지면서 대여 상태가 된다. 이 때 유저가 `대여 요청`을 취소하는 비율인 "대여 요청 취소율"이라는 지표가 있다고 해보자. 이 지표는 단순히 (1 - `대여` 숫자 / `대여 요청` 숫자)로 계산된다. 이때, 만약 운영 상의 이유로 어드민에서 `대여 요청` 없이 바로 `대여`를 해주는 새로운 기능이 생겼다면? 이 기능 때문에 대여 요청 취소율이 소폭 감소할 수 있을 것이다. 이 영향은 일어나도 괜찮은 영향인가?

이 예시는 **우리가 작성하는 비즈니스 로직이 미치는 영향이 어마어마하게 넓은 범위로 전파될 수 있음**을 보여준다. [데이터는 의존하는 컴포넌트가 많다](/general/be-careful-with-data.md#데이터는-의존하는-컴포넌트가-많다) 장에서 언급했듯이, 데이터에 의존하는 요소가 어마어마하게 많기 때문이다.

또한, 서비스를 운영하다 보면 피치 못하게 데이터를 강제로 조작해야 하는 상황이 종종 발생한다. 이는 서버 개발자가 DB에 `UPDATE` 쿼리를 직접 날리는 것일 수도 있고, 이런 `UPDATE` 쿼리를 날리는 작업을 자동화하여 사내 어드민에 넣은 것일 수도 있다. **이러한 강제 DML은 비즈니스 규칙을 따른다는 게 테스트로 보장이 되지 않기 때문에 정합성이 깨질 가능성이 매우 높고, 따라서 매우 위험하다.** 위의 도서관 예시를 들면, `대여` 객체와 매핑되는 `대여 요청` 객체가 반드시 존재한다고 가정하고 작성한 로직이 서버 어딘가에 있다고 해보자. 만약 어드민에서 강제로 꽂아준 `대여` 객체가 이 로직을 타게 된다면 NullPointerException 같은 에러가 발생할 것이다.

## 어떻게 해야 하는가?

데이터는 다루기 어렵고, 두렵다. 하지만 서버 개발자로서 데이터를 다루는 것은 피할 수 없는 일이다. 따라서 어려움과 두려움을 이겨낼 정도의 지식을 갖춰야 한다.

- 내가 하려는 로직 / 데이터 변경이 어떤 영향을 미칠지 예측하기 위해, 비즈니스 도메인을 아주 잘 이해해야 한다.
- 데이터에 의존하는 요소에 어떤 것이 있는지 정확히 파악하고 있어야 한다.
- 데이터를 리팩토링하는 올바른 방법을 공부해야 한다. \<Refactoring Database\>가 큰 도움이 될 것이다.
